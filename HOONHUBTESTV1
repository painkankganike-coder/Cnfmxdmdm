-- ✅ โหลด WindUI
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

local Window = WindUI:CreateWindow({
    Title = "HOON Hub",
    Icon = "gun",
    Author = "by As4r",
    Folder = "HOON Hub",
    Theme = "Dark",
})

Window:EditOpenButton({
    Title = "HOON Hub | test",
    Icon = "food",
    Color = ColorSequence.new(
        Color3.fromHex("FF0F7B"),
        Color3.fromHex("F89B29")
    ),
})

--------------------------------------------------------
-- 🟢 Aimbot Tab
--------------------------------------------------------
local Tab_Aimbot = Window:Tab({
    Title = "Aimbot",
    Icon = "crosshair",
})

-- =========================
-- Full Rainbow Aimbot (Nearest Head + Rainbow FOV & Tracer)
-- วางต่อท้ายในส่วน Tab_Aimbot ของสคริปต์ WindUI
-- =========================

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Settings (ปรับผ่าน WindUI)
local Aimbot_Enabled = false
local Aimbot_ShowFOV = true
local Aimbot_FOV = 120              -- พิกเซล
local Aimbot_Smoothness = 0.25      -- 0.01..1 (ยิ่งมาก = เร็วขึ้น)
local Aimbot_HoldToAim = false
local Aimbot_ProjectileSpeed = 0    -- studs/sec (0 = no prediction)
local Aimbot_TargetPart = "Head"    -- ส่วนที่ล็อก
local Rainbow_HueSpeed = 0.6        -- ความเร็วเปลี่ยนสีรุ้ง (ค่าเริ่มต้น)

-- Drawing objects
local fovCircle = Drawing.new("Circle")
fovCircle.Visible = false
fovCircle.Radius = Aimbot_FOV
fovCircle.Thickness = 2
fovCircle.NumSides = 100
fovCircle.Filled = false

local tracerLine = Drawing.new("Line")
tracerLine.Visible = false
tracerLine.Thickness = 2

-- helper: mouse pos & center
local function mousePos()
    return UserInputService:GetMouseLocation()
end

-- prediction helper (simple linear)
local function getPredictedPosition(part, projSpeed)
    if not part then return nil end
    if projSpeed and projSpeed > 0 then
        local dir = part.Position - Camera.CFrame.Position
        local dist = dir.Magnitude
        local travel = dist / projSpeed
        local vel = Vector3.new(0,0,0)
        local root = part.Parent and part.Parent:FindFirstChild("HumanoidRootPart")
        if root and root:IsA("BasePart") then
            vel = root.AssemblyLinearVelocity
        end
        return part.Position + vel * travel
    else
        return part.Position
    end
end

-- find nearest head to mouse within FOV
local function getClosestTarget()
    local center = mousePos()
    local best = nil
    local bestDist = math.huge

    for _, pl in ipairs(Players:GetPlayers()) do
        if pl ~= LocalPlayer and pl.Character and pl.Character:FindFirstChild(Aimbot_TargetPart) and pl.Character:FindFirstChild("Humanoid") then
            local hum = pl.Character.Humanoid
            if hum and hum.Health > 0 then
                local part = pl.Character:FindFirstChild(Aimbot_TargetPart)
                if part then
                    local screenPos, onScreen = Camera:WorldToViewportPoint(part.Position)
                    if onScreen then
                        local screenVec = Vector2.new(screenPos.X, screenPos.Y)
                        local dist = (screenVec - center).Magnitude
                        if dist <= Aimbot_FOV and dist < bestDist then
                            bestDist = dist
                            best = pl
                        end
                    end
                end
            end
        end
    end

    return best
end

-- aim camera smoothly to world pos
local function aimAt(worldPos, smooth)
    if not worldPos then return end
    local camPos = Camera.CFrame.Position
    local dir = (worldPos - camPos)
    if dir.Magnitude == 0 then return end
    local goal = CFrame.new(camPos, camPos + dir.Unit)
    Camera.CFrame = Camera.CFrame:Lerp(goal, math.clamp(smooth, 0, 1))
end

-- rainbow hue state
local hue = 0

-- main update loop
RunService.RenderStepped:Connect(function(dt)
    -- update hue
    hue = (hue + dt * Rainbow_HueSpeed) % 1
    local color = Color3.fromHSV(hue, 1, 1)

    -- update FOV drawing
    fovCircle.Position = mousePos()
    fovCircle.Radius = Aimbot_FOV
    fovCircle.Color = color
    fovCircle.Visible = Aimbot_Enabled and Aimbot_ShowFOV

    -- default hide tracer
    tracerLine.Visible = false

    if not Aimbot_Enabled then
        return
    end

    -- hold-to-aim check
    if Aimbot_HoldToAim and not UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        return
    end

    -- get target
    local targetPlayer = getClosestTarget()
    if not targetPlayer then return end
    local targetPart = targetPlayer.Character and targetPlayer.Character:FindFirstChild(Aimbot_TargetPart)
    if not targetPart then return end

    -- predicted pos & aim
    local aimPos = getPredictedPosition(targetPart, Aimbot_ProjectileSpeed)
    if aimPos then
        aimAt(aimPos, Aimbot_Smoothness)
    end

    -- draw rainbow tracer from screen center to target
    local screenFrom = mousePos() -- tracer start from mouse position (เปลี่ยนเป็น center screen ถ้าต้องการ)
    local tPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
    if onScreen then
        tracerLine.From = Vector2.new(screenFrom.X, screenFrom.Y)
        tracerLine.To = Vector2.new(tPos.X, tPos.Y)
        tracerLine.Color = color
        tracerLine.Visible = true
    end
end)

-- =========================
-- WindUI Controls (attach to Tab_Aimbot)
-- =========================
Tab_Aimbot:Toggle({
    Title = "Aimbot (Nearest Head)",
    Desc = "ล็อกหัวผู้เล่นที่ใกล้สุด (client-side camera only)",
    Icon = "target",
    Value = false,
    Callback = function(state)
        Aimbot_Enabled = state
        fovCircle.Visible = state and Aimbot_ShowFOV
        tracerLine.Visible = state
    end
})

Tab_Aimbot:Toggle({
    Title = "Show FOV",
    Desc = "แสดงวง FOV รอบเมาส์",
    Icon = "circle",
    Value = true,
    Callback = function(state)
        Aimbot_ShowFOV = state
        fovCircle.Visible = state and Aimbot_Enabled
    end
})

Tab_Aimbot:Slider({
    Title = "FOV Size",
    Desc = "ขนาดวง FOV (พิกเซล)",
    Step = 5,
    Value = {Min = 30, Max = 800, Default = Aimbot_FOV},
    Callback = function(value)
        Aimbot_FOV = value
        fovCircle.Radius = value
    end
})

Tab_Aimbot:Slider({
    Title = "Smoothness",
    Desc = "ค่าความนุ่มของการหมุนกล้อง (0.01..1.0)",
    Step = 0.01,
    Value = {Min = 0.01, Max = 1.0, Default = Aimbot_Smoothness},
    Callback = function(value)
        Aimbot_Smoothness = value
    end
})

Tab_Aimbot:Toggle({
    Title = "Hold to Aim (RMB)",
    Desc = "ถ้าเปิด ต้องกดขวาค้างเพื่อให้ aimbot ทำงาน",
    Icon = "mouse-pointer",
    Value = false,
    Callback = function(state)
        Aimbot_HoldToAim = state
    end
})

Tab_Aimbot:Dropdown({
    Title = "Target Part",

--------------------------------------------------------
-- 🔴 ESP Tab
--------------------------------------------------------
local Tab_ESP = Window:Tab({
    Title = "ESP",
    Icon = "eye",
})

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

------------------------------
-- 🟧 ESP Box 2D
------------------------------
local ESP_Box_Enabled = false
local ESP_Box_Objects = {}

local function CreateESPBox(player)
    if player == LocalPlayer then return end
    if ESP_Box_Objects[player] then return end

    local box = Drawing.new("Square")
    box.Color = Color3.fromRGB(255, 140, 0)
    box.Thickness = 1.5
    box.Filled = false
    box.Visible = false

    ESP_Box_Objects[player] = {Box = box}
end

local function RemoveESPBox(player)
    if ESP_Box_Objects[player] then
        for _, obj in pairs(ESP_Box_Objects[player]) do
            obj:Remove()
        end
        ESP_Box_Objects[player] = nil
    end
end

RunService.RenderStepped:Connect(function()
    if not ESP_Box_Enabled then
        for _, esp in pairs(ESP_Box_Objects) do
            esp.Box.Visible = false
        end
        return
    end

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local root = player.Character.HumanoidRootPart
            local pos, visible = Camera:WorldToViewportPoint(root.Position)
            local esp = ESP_Box_Objects[player] or CreateESPBox(player) or ESP_Box_Objects[player]

            if visible and esp then
                local height = 2000 / pos.Z
                local width = height / 1.5
                esp.Box.Size = Vector2.new(width, height)
                esp.Box.Position = Vector2.new(pos.X - width/2, pos.Y - height/2)
                esp.Box.Visible = true
            elseif esp then
                esp.Box.Visible = false
            end
        end
    end
end)

Tab_ESP:Toggle({
    Title = "Box ",
    Desc = "แสดงกล่องรอบผู้เล่น",
    Icon = "square",
    Value = false,
    Callback = function(state)
        ESP_Box_Enabled = state
        if state then
            for _, player in pairs(Players:GetPlayers()) do
                CreateESPBox(player)
            end
            Players.PlayerAdded:Connect(CreateESPBox)
            Players.PlayerRemoving:Connect(RemoveESPBox)
        end
    end
})

------------------------------
-- 🟦 ESP Name
------------------------------
local ESP_Name_Enabled = false
local ESP_Name_Objects = {}

local function CreateNameTag(player)
    if player == LocalPlayer then return end
    if ESP_Name_Objects[player] then return end

    local nameText = Drawing.new("Text")
    nameText.Size = 13
    nameText.Color = Color3.fromRGB(255, 255, 255)
    nameText.Center = true
    nameText.Outline = true
    nameText.Visible = false
    nameText.Font = 2

    ESP_Name_Objects[player] = {Name = nameText}
end

local function RemoveNameTag(player)
    if ESP_Name_Objects[player] then
        for _, obj in pairs(ESP_Name_Objects[player]) do
            obj:Remove()
        end
        ESP_Name_Objects[player] = nil
    end
end

RunService.RenderStepped:Connect(function()
    if not ESP_Name_Enabled then
        for _, esp in pairs(ESP_Name_Objects) do
            esp.Name.Visible = false
        end
        return
    end

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            local pos, visible = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 1.5, 0))
            local esp = ESP_Name_Objects[player] or CreateNameTag(player) or ESP_Name_Objects[player]

            if visible and esp then
                local distance = (LocalPlayer.Character.HumanoidRootPart.Position - head.Position).Magnitude
                local size = math.clamp(13 - (distance/150), 10, 13)

                esp.Name.Text = player.Name
                esp.Name.Size = size
                esp.Name.Position = Vector2.new(pos.X, pos.Y - 20)
                esp.Name.Visible = true
            elseif esp then
                esp.Name.Visible = false
            end
        end
    end
end)

Tab_ESP:Toggle({
    Title = "Name",
    Desc = "แสดงชื่อผู้เล่น",
    Icon = "user",
    Value = false,
    Callback = function(state)
        ESP_Name_Enabled = state
        if state then
            for _, player in pairs(Players:GetPlayers()) do
                CreateNameTag(player)
            end
            Players.PlayerAdded:Connect(CreateNameTag)
            Players.PlayerRemoving:Connect(RemoveNameTag)
        end
    end
})
--------------------------------------------------------
-- 🟠 Highlight ESP (สีส้ม)
--------------------------------------------------------
Tab_ESP:Button({
    Title = " Highlight",
    Desc = "Highlight ผู้เล่นทุกคนเป็นสี",
    Callback = function()
        local function CreateESP(player)
            if player.Character and player.Character:FindFirstChild("Head") then
                if player.Character:FindFirstChild("ESPHighlight") then
                    player.Character.ESPHighlight:Destroy()
                end
                local highlight = Instance.new("Highlight")
                highlight.Name = "ESPHighlight"
                highlight.FillColor = Color3.fromRGB(255, 128, 0)
                highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                highlight.FillTransparency = 0.5
                highlight.Parent = player.Character
            end
        end

        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                CreateESP(player)
            end
        end

        Players.PlayerAdded:Connect(function(player)
            player.CharacterAdded:Connect(function()
                task.wait(1)
                CreateESP(player)
            end)
        end)
    end
})

--------------------------------------------------------
-- 🩸 ESP HP BAR (แยกเปิดปิด)
--------------------------------------------------------

local ESP_HP_Enabled = false
local ESP_HP_Objects = {}
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- 🧩 ฟังก์ชันสร้าง HP Bar
local function CreateHPBar(player)
    if player == LocalPlayer then return end
    if ESP_HP_Objects[player] then return end

    local hpBar = Drawing.new("Line")
    hpBar.Thickness = 3
    hpBar.Color = Color3.fromRGB(0, 255, 0)
    hpBar.Visible = false

    ESP_HP_Objects[player] = {HP = hpBar}
end

local function RemoveHPBar(player)
    if ESP_HP_Objects[player] then
        for _, obj in pairs(ESP_HP_Objects[player]) do
            obj:Remove()
        end
        ESP_HP_Objects[player] = nil
    end
end

-- 🔁 อัปเดต HP ทุกเฟรม
RunService.RenderStepped:Connect(function()
    if not ESP_HP_Enabled then
        for _, esp in pairs(ESP_HP_Objects) do
            esp.HP.Visible = false
        end
        return
    end

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Humanoid") then
            local root = player.Character.HumanoidRootPart
            local humanoid = player.Character.Humanoid
            local pos, visible = Camera:WorldToViewportPoint(root.Position)

            if visible then
                local height = 2000 / pos.Z
                local width = height / 1.5
                local x = pos.X - width / 2
                local y = pos.Y - height / 2

                local esp = ESP_HP_Objects[player]
                if esp then
                    local hpPercent = math.clamp(humanoid.Health / humanoid.MaxHealth, 0, 1)
                    local barStart = Vector2.new(x - 6, y + height)
                    local barEnd = Vector2.new(x - 6, y + height - (height * hpPercent))

                    esp.HP.Visible = true
                    esp.HP.From = barStart
                    esp.HP.To = barEnd
                    esp.HP.Color = Color3.fromRGB(
                        255 - (hpPercent * 255),
                        hpPercent * 255,
                        0
                    )
                else
                    CreateHPBar(player)
                end
            else
                if ESP_HP_Objects[player] then
                    ESP_HP_Objects[player].HP.Visible = false
                end
            end
        end
    end
end)

-- ⚙️ ฟังก์ชันเปิด/ปิด
local function EnableESP_HP()
    ESP_HP_Enabled = true
    print("✅ เปิด ESP HP Bar แล้ว")
    for _, player in pairs(Players:GetPlayers()) do
        CreateHPBar(player)
    end
    Players.PlayerAdded:Connect(CreateHPBar)
    Players.PlayerRemoving:Connect(RemoveHPBar)
end

local function DisableESP_HP()
    ESP_HP_Enabled = false
    print("❌ ปิด ESP HP Bar แล้ว")
    for _, player in pairs(Players:GetPlayers()) do
        RemoveHPBar(player)
    end
end

--------------------------------------------------------
-- 🕹️ เพิ่มปุ่มใน WindUI
--------------------------------------------------------
Tab_ESP:Toggle({
    Title = "HP Bar",
    Desc = "แสดงแถบเลือด",
    Icon = "activity",
    Value = false,
    Callback = function(state)
        if state then
            EnableESP_HP()
        else
            DisableESP_HP()
        end
    end
})

--------------------------------------------------------
-- 🧍 Character Tab (WalkSpeed + Slider)
--------------------------------------------------------
local Tab_Character = Window:Tab({
    Title = "Character",
    Icon = "user",
})

--------------------------------------------------------
-- 🟢 Character Tab (WalkSpeed + Jump + Mud Warp)
--------------------------------------------------------
local Tab_Character = Window:Tab({
    Title = "Character",
    Icon = "user",
})

-- WalkSpeed
local SpeedEnabled = false
local DefaultSpeed = 16
local CustomSpeed = 50

Tab_Character:Toggle({
    Title = "Walk Speed",
    Desc = "เปิด/ปิดความเร็วเดิน",
    Icon = "zap",
    Value = false,
    Callback = function(state)
        SpeedEnabled = state
        local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("Humanoid")
        if humanoid then
            if state then
                humanoid.WalkSpeed = CustomSpeed
                print("✅ เปิดโหมด Speed (" .. CustomSpeed .. ")")
            else
                humanoid.WalkSpeed = DefaultSpeed
                print("❌ ปิดโหมด Speed กลับเป็นปกติ")
                humanoid.WalkSpeed = DefaultSpeed
            end
        end
    end
})

Tab_Character:Slider({
    Title = "Speed Value",
    Desc = "ปรับระดับความเร็วการเดิน",
    Step = 1,
    Value = {Min = 16, Max = 50, Default = 16},
    Callback = function(value)
        CustomSpeed = value
        if SpeedEnabled then
            local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = value
            end
        end
    end
})

--------------------------------------------------------
-- 🟢 Super Jump
--------------------------------------------------------
local JumpEnabled = false
local JumpPower = 100 -- ตั้งค่ากระโดด

Tab_Character:Toggle({
    Title = "Super Jump",
    Desc = "เปิด/ปิดกระโดดสูง",
    Icon = "arrow-up",
    Value = false,
    Callback = function(state)
        JumpEnabled = state
        local humanoid = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("Humanoid")
        if humanoid then
            if state then
                humanoid.JumpPower = JumpPower
            else
                humanoid.JumpPower = 50
            end
        end
    end
})

--------------------------------------------------------
-- 🟢 Mud Warp (มุดดิน)
--------------------------------------------------------
local MudEnabled = false
local MudDepth = 10 -- ความลึกเริ่มต้น

Tab_Character:Toggle({
    Title = "Snap",
    Desc = "เปิด/ปิด มุดดิน",
    Icon = "arrow-down",
    Value = false,
    Callback = function(state)
        MudEnabled = state
        local char = game.Players.LocalPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            local hrp = char.HumanoidRootPart
            if state then
                hrp.CFrame = hrp.CFrame - Vector3.new(0, MudDepth, 0)
                print("✅ Mud Warp ON | Depth: " .. MudDepth)
            else
                hrp.CFrame = hrp.CFrame + Vector3.new(0, MudDepth, 0)
                print("❌ Mud Warp OFF")
            end
        end
    end
})

Tab_Character:Slider({
    Title = "Snap",
    Desc = "ปรับความลึกในการมุดดิน",
    Step = 1,
    Value = {Min = 1, Max = 50, Default = MudDepth},
    Callback = function(value)
        MudDepth = value
        if MudEnabled then
            local char = game.Players.LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local hrp = char.HumanoidRootPart
                hrp.CFrame = hrp.CFrame - Vector3.new(0, MudDepth, 0)
            end
        end
    end
})
